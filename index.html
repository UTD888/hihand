<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bonus High Hand</title>
  <link href="https://fonts.googleapis.com/css2?family=Saira&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
  <style>
    body {
      font-family: 'Saira', sans-serif;
      background: #f2f2f2;
      padding: 10px;
      margin: 0;
      text-align:center;
    }
    .card {
      background: #fff;
      padding: 15px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin-bottom: 15px;
      
    }
    .title {
      font-size: 45px;
      font-weight: bold;
      margin-bottom: 8px;
      cursor: pointer;
    }
    .bonus {
      font-size: 18px;
      margin: 4px 0;
      font-size: 40px;
    }
    .admin {
      margin-top: 10px;
    }
    .history-entry {
      border-bottom: 1px solid #ccc;
      padding: 8px 0;
    }
    .hidden {
      display: none;
    }
    #clearHistoryBtn {
      margin-top: 10px;
      background: #c00;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
    }
    input, select, button {
  width: 90%;
  max-width: 320px;
  padding: 10px;
  margin: 8px auto;
  box-sizing: border-box;
  border: 1px solid #ccc;
  border-radius: 8px;
  display: block;
  font-size: 16px;
}

    #menuIcon {
  position: fixed;
  top: 12px;
  right: 12px;
  background: #333;
  color: white;
  padding: 8px 10px;
  border-radius: 50%;
  font-size: 20px;
  cursor: pointer;
  z-index: 1000;
  width: 42px;
  height: 42px;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.15);
}


    #loginPopup {
      position: fixed;
      top: 50px;
      right: 10px;
      width: 280px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 0 12px rgba(0,0,0,0.2);
      display: none;
      z-index: 1000;
    }
  @media (max-width: 480px) {
  .bonus {
    font-size: 28px;
  }
  input, select, button {
    font-size: 14px;
    padding: 8px;
    width: 100%;
    max-width: 100%;
  }
  .card {
    padding: 10px;
  }
  .title {
    font-size: 28px;
  }
}


  </style>
</head>
<body onclick="closePopupOnOutside(event)">
  <div style="text-align: center; margin-bottom: 10px;">
    <img src="luxu-logo.png" alt="Luxu Logo" width="120" />
  </div>

  <div id="menuIcon" onclick="toggleLoginPopup(event)">‚ò∞</div>

  <div id="loginPopup">
    <div id="loginForm">
      <input type="email" id="loginEmail" placeholder="Email" />
      <input type="password" id="loginPassword" placeholder="Password" />
      <button onclick="loginWithEmail()">üîê Login</button>
    </div>
    <div id="loggedInBox" class="hidden">
      <span id="userEmail"></span>
      <button onclick="logout()">üö™ Logout</button>
    </div>
  </div>

  

  <div class="card">
    <div class="title">Bonus High Hand</div>
    <div id="currentDateTime" style="color: gray; font-size: 16px; margin-top: -10px; margin-bottom: 10px;"></div>
    <div class="bonus">Current Bonus: <span id="currentBonus">‡∏ø5000</span></div>
    <div class="bonus">Royal Flush Bonus: <span id="royalBonus">‡∏ø3750</span></div>
    <div class="bonus">Straight Flush Bonus: <span id="straightBonus">‡∏ø2250</span></div>
    <div class="bonus">Quads Cards Bonus: <span id="quadsBonus">‡∏ø1000</span></div>
    <p>‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏• Hight Hand</p>
    <p>- 1 ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏ö‡πÄ‡∏ö‡∏£‡∏Å</p>
    <p>- ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤ ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏£‡∏ß‡∏°‡∏à‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 500</p>
    <p>- ‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏£‡∏ß‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏µ‡πà 5000 ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÉ‡∏´‡πâ‡πÅ‡∏ï‡πà‡∏•‡∏∞‡πÅ‡∏Æ‡∏ô‡∏î‡πå ‡∏ï‡∏≤‡∏°‡∏ï‡∏≤‡∏£‡∏≤‡∏á</p>
    
    <div class="admin">
      <button id="editBonusBtn" class="hidden" onclick="showBonusEdit()">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Bonus</button>
      <div id="bonusEditBox" class="hidden">
        <input type="number" id="newBonus" placeholder="‡πÉ‡∏™‡πà‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÉ‡∏´‡∏°‡πà" />
        <button onclick="updateBonus()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
      <div id="rewardForm" class="hidden">
        <div class="title">‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</div>
        <input type="text" id="playerName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô" />
        <select id="handType">
          <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏Æ‡∏ô‡∏î‡πå</option>
          <option value="Royal Flush">Royal Flush</option>
          <option value="Straight Flush">Straight Flush</option>
          <option value="Quads">Quads</option>
        </select>
        <input type="file" id="imageUpload" accept="image/*" />
        <button onclick="submitReward()">‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</button>

        <div>
          <div class="title" onclick="toggleBonusHistory()">Changed History ‚ñº</div>
          <div id="bonusHistoryContainer" class="hidden">
            <ul id="bonusHistoryList"></ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="title" onclick="toggleHistory()">üìú Bonus History ‚ñº</div>
    <div id="historyContainer" class="hidden">
      <div id="historyList"></div>
      <button id="clearHistoryBtn" class="hidden" onclick="clearHistory()">üóë ‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyAtxMJQMwzhZz9QtiHuBlF4L58jRKgI90A",
      authDomain: "highthand-f9bc6.firebaseapp.com",
      projectId: "highthand-f9bc6",
      storageBucket: "highthand-f9bc6.firebasestorage.app",
      messagingSenderId: "60442905889",
      appId: "1:60442905889:web:6d1f9f25a03e0a6a5dc260",
      measurementId: "G-G2CN0QMEJB"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    let currentBonus = 5000;

    function renderBonus() {
      document.getElementById('currentBonus').innerText = `‡∏ø${currentBonus}`;
      document.getElementById('royalBonus').innerText = `‡∏ø${Math.floor(currentBonus * 0.75)}`;
      document.getElementById('straightBonus').innerText = `‡∏ø${Math.floor(currentBonus * 0.45)}`;
      document.getElementById('quadsBonus').innerText = `‡∏ø${Math.floor(currentBonus * 0.2)}`;
    }

    function showBonusEdit() {
      document.getElementById('bonusEditBox').classList.toggle('hidden');
    }

    function toggleHistory() {
      document.getElementById('historyContainer').classList.toggle('hidden');
    }

    function toggleBonusHistory() {
      document.getElementById('bonusHistoryContainer')?.classList.toggle('hidden');
    }

    async function updateBonus() {
  const newBonus = parseInt(document.getElementById('newBonus').value);
  if (isNaN(newBonus) || newBonus < 0) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");

  const oldBonus = currentBonus;

  const confirmed = confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Bonus:\n‡∏à‡∏≤‡∏Å ‡∏ø${oldBonus} ‚Üí ‡∏ø${newBonus}`);
  if (!confirmed) return;

  try {
    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Bonus ‡πÉ‡∏´‡∏°‡πà
    await db.collection("config").doc("bonus").set({ current: newBonus });

    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
    await db.collection("bonus_history").add({
      timestamp: firebase.firestore.FieldValue.serverTimestamp(),
      oldBonus,
      newBonus
    });

    // ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ + ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
    document.getElementById('bonusEditBox').classList.add('hidden');
    document.getElementById('newBonus').value = '';

    alert("‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Bonus ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß");
    loadBonusHistory();
  } catch (err) {
    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Bonus");
    console.error(err);
  }
}


  async function submitReward() {
  const name = document.getElementById('playerName').value;
  const hand = document.getElementById('handType').value;
  const file = document.getElementById('imageUpload').files[0];
  if (!name || !hand || !file) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');

  try {
    // ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏†‡∏≤‡∏û‡πÑ‡∏õ imgbb
    const formData = new FormData();
    formData.append("image", file);
    formData.append("key", "9558962805185271b57918df4e218713");
    const res = await fetch("https://api.imgbb.com/1/upload", {
      method: "POST",
      body: formData
    });
    const json = await res.json();
    const imgUrl = json.data.url;

    // ‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤ current bonus
    const bonusDoc = await db.collection("config").doc("bonus").get();
    let current = bonusDoc.exists ? bonusDoc.data().current || 5000 : 5000;

    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
    let percent = 0;
    if (hand === "Royal Flush") percent = 0.75;
    else if (hand === "Straight Flush") percent = 0.45;
    else if (hand === "Quads") percent = 0.2;

    const amount = Math.floor(current * percent);
    let newBonus = current - amount;
    if (newBonus < 5000) newBonus = 5000;

    const confirmText = `‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢ Bonus (${hand}) ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‡∏ø${amount} ‡πÉ‡∏´‡πâ ${name} ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`;
    const confirmed = confirm(confirmText);
    if (!confirmed) return;

    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•
    await db.collection("history").add({
      name, hand, imgUrl, amount,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    });

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡πÉ‡∏´‡∏°‡πà
    await db.collection("config").doc("bonus").set({ current: newBonus });

    alert(`‚úÖ ‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à\n‡∏à‡πà‡∏≤‡∏¢‡πÇ‡∏ö‡∏ô‡∏±‡∏™‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ‡∏ø${amount} ‡πÅ‡∏•‡πâ‡∏ß`);
    renderBonus();
    loadHistory();
  } catch (err) {
    console.error(err);
    alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£");
  }
}




    async function clearHistory() {
      if (!confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) return;
      const snap = await db.collection("history").get();
      const batch = db.batch();
      snap.forEach(doc => batch.delete(doc.ref));
      await batch.commit();
      loadHistory();
    }

    async function loadHistory() {
  const snap = await db.collection("history").orderBy("timestamp", "desc").get();
  const list = document.getElementById('historyList');
  list.innerHTML = '';

  if (snap.empty) {
    list.innerHTML = '<div style="color: gray; font-style: italic;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>';
    return;
  }

  snap.forEach(doc => {
    const d = doc.data();
    const date = d.timestamp?.toDate().toLocaleString('th-TH') || "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡πÄ‡∏ß‡∏•‡∏≤";
    const div = document.createElement('div');
    div.className = 'history-entry';
    div.innerHTML = `
      <b>${d.name}</b> - ${d.hand}<br>
      ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö: ‡∏ø${d.amount} <br>
      ‡πÄ‡∏ß‡∏•‡∏≤: ${date}<br>
      <img src="${d.imgUrl}" width="200">
    `;
    list.appendChild(div);
  });
}



    function loginWithEmail() {
  const email = document.getElementById('loginEmail').value;
  const password = document.getElementById('loginPassword').value;
  if (!email || !password) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô");

  auth.signInWithEmailAndPassword(email, password)
    .then(() => {
      document.getElementById("loginPopup").style.display = "none"; // ‚úÖ ‡∏õ‡∏¥‡∏î popup ‡πÄ‡∏°‡∏∑‡πà‡∏≠ login ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
    })
    .catch(err => alert("‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: " + err.message));
}


    function logout() {
  auth.signOut().then(() => {
    document.getElementById("loginPopup").style.display = "none"; // ‚úÖ ‡∏õ‡∏¥‡∏î popup ‡πÄ‡∏°‡∏∑‡πà‡∏≠ logout
  });
}


    auth.onAuthStateChanged(user => {
      const emailSpan = document.getElementById("userEmail");
      const loginForm = document.getElementById("loginForm");
      const loggedInBox = document.getElementById("loggedInBox");
      const clearBtn = document.getElementById("clearHistoryBtn");

      if (user) {
        emailSpan.textContent = user.email;
        loginForm.classList.add("hidden");
        loggedInBox.classList.remove("hidden");

        document.getElementById("editBonusBtn").classList.remove("hidden");
        document.getElementById("rewardForm").classList.remove("hidden");
        clearBtn.classList.remove("hidden");
      } else {
        emailSpan.textContent = "";
        loginForm.classList.remove("hidden");
        loggedInBox.classList.add("hidden");
        document.getElementById("editBonusBtn").classList.add("hidden");
        document.getElementById("rewardForm").classList.add("hidden");
        clearBtn.classList.add("hidden");
      }
    });

    db.collection("config").doc("bonus").onSnapshot(doc => {
  if (doc.exists) {
    currentBonus = doc.data().current || 5000;
    renderBonus();
  }
});


    renderBonus();
    loadHistory();
    loadBonusHistory();

  async function loadBonusHistory() {
  const snap = await db.collection("bonus_history").orderBy("timestamp", "desc").get();
  const list = document.getElementById("bonusHistoryList");
  list.innerHTML = '';

  snap.forEach(doc => {
    const d = doc.data();
    const date = d.timestamp?.toDate().toLocaleString('th-TH') || "‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡πÄ‡∏ß‡∏•‡∏≤";
    const li = document.createElement('li');
    li.textContent = `${date} - ‡∏à‡∏≤‡∏Å ‡∏ø${d.oldBonus} ‚Üí ‡∏ø${d.newBonus}`;
    list.appendChild(li);
  });
}
function updateDateTime() {
  const now = new Date();
  const options = { dateStyle: 'short', timeStyle: 'medium', hour12: false };
  const formatted = now.toLocaleString('th-TH', options);
  document.getElementById('currentDateTime').textContent = `üìÖ ${formatted}`;
}
setInterval(updateDateTime, 1000);
updateDateTime(); // ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î

function toggleLoginPopup(event) {
      event.stopPropagation(); // ‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏•‡∏∏‡∏î‡∏õ‡∏¥‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
      const popup = document.getElementById("loginPopup");
      popup.style.display = popup.style.display === 'none' || popup.style.display === '' ? 'block' : 'none';
    }

    function closePopupOnOutside(event) {
      const popup = document.getElementById("loginPopup");
      const menuIcon = document.getElementById("menuIcon");
      if (!popup.contains(event.target) && !menuIcon.contains(event.target)) {
        popup.style.display = 'none';
      }
    }
  </script>
</body>
</html>
