<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Bonus High Hand</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
  body {
    font-family: Arial, sans-serif;
    background: #f9f9f9;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 100vh;
    padding: 20px;
  }

  .container {
    width: 100%;
    max-width: 800px;
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    text-align: center;
  }

  h1 {
    color: #007bff;
  }

  .stat {
    font-size: clamp(24px, 5vw, 70px); /* responsive */
    margin-bottom: 15px;
  }

  .highlight {
    color: #d9534f;
    font-weight: bold;
  }

  .btn {
    background: #007bff;
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 6px;
    cursor: pointer;
    margin: 5px;
    font-size: 16px;
  }

  .btn:hover {
    background: #0056b3;
  }

  .hidden {
    display: none !important;
  }

  input, select {
    width: 100%;
    padding: 10px;
    margin-top: 5px;
    margin-bottom: 10px;
    font-size: 16px;
  }

  .history-entry {
    border-top: 1px solid #ccc;
    padding: 10px 0;
    text-align: left;
    font-size: 16px;
  }

  #auth-section {
    width: 100%;
    max-width: 300px;
    margin: 0 auto 20px auto;
  }

  .admin {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin: 20px auto;
  }

  @media (max-width: 600px) {
    .stat span {
      font-size: 30px !important;
    }
    #royalBonus, #straightBonus, #quadsBonus {
      font-size: 24px !important;
    }
    .btn {
      width: 100%;
      font-size: 18px;
    }
  }
</style>

</head>
<body>
    
  <div class="container">
    <img src="luxu-logo.png" width="25%;">
     
<div class="stat"><span>Bonus Hight Hand</span><br><span id="totalBonus" class="highlight">Loading...</span></div>
<div class="stat"><span style="font-size: 50px;">Royal Flush (75%)</span><br><span id="royalBonus" style="font-size: 50px;font-weight: bold;color: #098633;">Loading...</span></div>
<div class="stat"><span style="font-size: 50px;">Straight Flush (45%)</span><br><span id="straightBonus" style="font-size: 50px;font-weight: bold;color: #098633;">Loading...</span></div>
<div class="stat"><span style="font-size: 50px;">Quads (20%)</span><br><span id="quadsBonus" style="font-size: 50px;font-weight: bold;color: #098633;">Loading...</span></div>

<div id="auth-section" class="admin hidden">
  <input type="email" id="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
  <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
  <button class="btn" id="loginBtn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
</div>


<div id="app-section" class="hidden">
  <button class="btn" onclick="showPayoutForm()">üì§ ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</button>
  <button class="btn" onclick="logout()" style="background:#dc3545;">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
  <div id="payoutForm" class="hidden">
    <h3>‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h3>
    <input type="text" id="playerName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô">
    <select id="handType">
      <option value="royal">Royal Flush</option>
      <option value="straight">Straight Flush</option>
      <option value="quads">Quads</option>
    </select>
    <button class="btn" onclick="confirmPayout()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
    <button class="btn" onclick="cancelPayout()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    <div id="payoutMsg" class="stat"></div>
  </div>

</div>
<button class="btn" onclick="toggleHistory()">üìú ‡∏î‡∏π/‡∏ã‡πà‡∏≠‡∏ô ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢</button>
<div id="historyContainer" class="hidden">
  <h3>üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•</h3>
  <div id="historyList">Loading...</div>
</div>

  <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import {
    getAuth,
    signInWithEmailAndPassword,
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import {
    getFirestore,
    doc,
    getDoc,
    setDoc,
    updateDoc,
    collection,
    addDoc,
    query,
    orderBy,
    limit,
    getDocs,
    serverTimestamp,
    onSnapshot
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAtxMJQMwzhZz9QtiHuBlF4L58jRKgI90A",
    authDomain: "highthand-f9bc6.firebaseapp.com",
    projectId: "highthand-f9bc6",
    storageBucket: "highthand-f9bc6.firebasestorage.app",
    messagingSenderId: "60442905889",
    appId: "1:60442905889:web:6d1f9f25a03e0a6a5dc260",
    measurementId: "G-G2CN0QMEJB"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const db = getFirestore();

    const BONUS_RATES = { royal: 0.75, straight: 0.45, quads: 0.2 };

    refreshStats();
    loadHistory();
document.getElementById("loginBtn").addEventListener("click", () => {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  signInWithEmailAndPassword(auth, email, password)
    .catch(err => alert("Login error: " + err.message));
});

 onAuthStateChanged(auth, async user => {
  if (user) {
    document.getElementById("auth-section").classList.add("hidden");
    document.getElementById("app-section").classList.remove("hidden");
    window.currentUser = user;
    await refreshStats();  // üü¢ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á
    await loadHistory();
  } else {
    document.getElementById("auth-section").classList.remove("hidden");
    document.getElementById("app-section").classList.add("hidden");
    await refreshStats();  // üü¢ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
    await loadHistory();
  }
});


    window.logout = () => signOut(auth);

  async function refreshStats() {
  const statRef = doc(db, "stats", "highhand");
  const snap = await getDoc(statRef);

  let bonus = 5000;
  let last = null;

  if (snap.exists()) {
    const data = snap.data();
    bonus = data.totalBonus ?? 5000;
    last = data.latestPayoutTimestamp?.toDate();
  }

  // ‚úÖ ‡∏ñ‡πâ‡∏≤ bonus < 5000 ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô 5000 ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  if (bonus < 5000) bonus = 5000;

  window.baseBonus = bonus;
  window.lastPayoutTime = last || new Date();

  startLiveBonusTimer();
}




    window.showPayoutForm = async () => {
      const statRef = doc(db, "stats", "highhand");
      const snap = await getDoc(statRef);
      const last = snap.data()?.latestPayoutTimestamp?.toDate();
      const now = new Date();
      const form = document.getElementById("payoutForm");
      const msg = document.getElementById("payoutMsg");
      form.classList.remove("hidden");

      if (last && now - last < 24 * 60 * 60 * 1000) {
        const msLeft = 24 * 60 * 60 * 1000 - (now - last);
        const hours = Math.floor(msLeft / (60 * 60 * 1000));
        const minutes = Math.floor((msLeft % (60 * 60 * 1000)) / (60 * 1000));
        msg.innerText = `‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏≠‡∏≠‡∏µ‡∏Å ${hours} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ${minutes} ‡∏ô‡∏≤‡∏ó‡∏µ ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÑ‡∏î‡πâ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á`;
      } else {
        msg.innerText = "";
      }
    };

    window.cancelPayout = () => {
      document.getElementById("payoutForm").classList.add("hidden");
      document.getElementById("payoutMsg").innerText = "";
    };

    window.confirmPayout = async () => {
      const player = document.getElementById("playerName").value;
      const type = document.getElementById("handType").value;
      const rate = BONUS_RATES[type];
      const amount = Math.floor(window.latestBonus * rate);

      if (!player || !type || isNaN(amount)) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
        return;
      }

      const statRef = doc(db, "stats", "highhand");
      const snap = await getDoc(statRef);
      const last = snap.data()?.latestPayoutTimestamp?.toDate();
      const now = new Date();
      if (last && now - last < 24 * 60 * 60 * 1000) {
        alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ");
        return;
      }

      await addDoc(collection(db, "highhand_rewards"), {
        player,
        handType: type,
        amountPaid: amount,
        paidAt: serverTimestamp(),
        paidBy: window.currentUser.email
      });

      await updateDoc(statRef, {
        totalBonus: window.latestBonus - amount,
        latestPayoutTimestamp: serverTimestamp()
      });

      document.getElementById("payoutForm").classList.add("hidden");
      document.getElementById("payoutMsg").innerText = "";
      await refreshStats();
      await loadHistory();
      
    };

    function loadHistory() {
  const q = query(collection(db, "highhand_rewards"), orderBy("paidAt", "desc"), limit(10));
  const historyList = document.getElementById("historyList");

  onSnapshot(q, (snap) => {
    historyList.innerHTML = "";
    snap.forEach(doc => {
      const d = doc.data();
      const time = d.paidAt?.toDate().toLocaleString();
      historyList.innerHTML += `<div class='history-entry'>üéñÔ∏è ${d.player} ‡πÑ‡∏î‡πâ ${d.handType.toUpperCase()} ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô ${d.amountPaid} ‡πÇ‡∏î‡∏¢ ${d.paidBy} (${time})</div>`;
    });
  });
}

function startLiveBonusTimer() {
  const el = document.getElementById("totalBonus");
  const royalEl = document.getElementById("royalBonus");
  const straightEl = document.getElementById("straightBonus");
  const quadsEl = document.getElementById("quadsBonus");

  function update() {
    const now = new Date();
    const base = window.baseBonus || 5000;
    const last = window.lastPayoutTime || now;
    const elapsedMs = now - last;
    const additional = (elapsedMs / (24 * 60 * 60 * 1000)) * 500;
    let liveBonus = base + additional;
    if (liveBonus < 5000) liveBonus = 5000;

    // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡∏Ç‡∏¢‡∏±‡∏ö‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á
    el.innerText = liveBonus.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    royalEl.innerText = (liveBonus * BONUS_RATES.royal).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    straightEl.innerText = (liveBonus * BONUS_RATES.straight).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    quadsEl.innerText = (liveBonus * BONUS_RATES.quads).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

    // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏ï‡πá‡∏°‡πÑ‡∏ß‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢
    window.latestBonus = liveBonus;

    requestAnimationFrame(update);
  }

  requestAnimationFrame(update);
}






window.toggleHistory = () => {
  const container = document.getElementById("historyContainer");
  container.classList.toggle("hidden");
};
window.login = () => {
  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;
  signInWithEmailAndPassword(auth, email, password)
    .catch(err => alert("Login error: " + err.message));
};

  </script>
</body>
</html>
